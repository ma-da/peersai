import requests
import json

# Our dedicated gateway is: peers.mypinata.cloud

# UPLOAD FILE

# Pinata JWT
JWT = "THE JWT"

# Path to your local .txt file
file_path = "C:/datasources/PEERSAITEST1.txt"

# Desired name and metadata (values must be strings)
name = "PEERSAITEST1.txt"
keyvalues = {
    "env": "prod"
}

# Pinata expects the keyvalues field formatted as:
# {
#   "keyvalues": {
#     "env": "prod"
#   }
# }
metadata_json = {
    "keyvalues": {k: str(v) for k, v in keyvalues.items()}
}

# Open and upload file
with open(file_path, "rb") as file_data:
    files = {
        "file": (file_path, file_data, "text/plain")
    }

    data = {
        "network": "public",
        "name": name,
        "metadata": json.dumps(metadata_json)  # this key must be called 'metadata'
    }

    headers = {
        "Authorization": f"Bearer {JWT}"
    }

    response = requests.post(
        "https://uploads.pinata.cloud/v3/files",
        headers=headers,
        files=files,
        data=data
    )

# Handle the response
if response.ok:
    print("Upload successful!")
    print(response.json())
else:
    print("Upload failed:", response.status_code)
    print(response.text)

# Sample successful response - mote that cid is the standard identifier for reference    
# Upload successful!
# {'data': {'id': '0198803f-c882-7534-9aeb-36c12c0513cc', 'name': 'PEERSAITEST1.txt', 'size': 177, 'mime_type': 'directory', 'cid': 'bafybeiean24z5phlz2eqdxuph7y6ononukmdr2p2cgrbxr3bmwuq5y5ime', 'network': 'public', 'number_of_files': 1, 'streamable': False, 'created_at': '2025-08-06T16:38:40.796Z', 'updated_at': '2025-08-06T16:38:40.796Z'}}
    
    
# RETRIEVE FILE

# will update once custom domain is set up and connected to our gateway 
